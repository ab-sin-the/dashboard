{% macro layout_block(layout, graphs) -%}
<script>
function fn_toogle_legend_flot(a, i) {
    var $container = $('.chart-' + i).parent();
    var $l = $container.find('.legend');
    console.log($container.html());
    if ($l.is(':hidden')) {
        $l.show();
    } else {
        $l.hide();
    }
    return false;
}

function fn_toogle_sum_flot(a, i) {
    var $container = $('.chart-' + i).parent();
    var url = $container.data('u');
    var u = $.query.load(url);
    var s = u.get('sum');
    if (s && s === 'on') {
        s = 'off';
    } else {
        s = 'on';
    }
    u = u.set('sum', s);
    var dataU = url.split('?')[0] + u.toString();
    $container.data('u', dataU);

    // 重新请求这个url
    if (window.getData) {
        window.getData($container, dataU);
    }
    return false;
}

$(function(){
    //setInterval(function() {
    //    if (window.active) {
    //        active();
    //    }
    //}, 60000);
});
</script>

        {%set i=0%}
        <div class="row">
        {%for graph in graphs%}
           {% if (i % layout == 0) %}
             <div style="clear: both;">
           {% endif %}
                {% set col = (12/layout)|int %}
                {% if (i % layout == 0) %}
                <div class="col-md-{{col}}" id="graph-{{i}}" style="padding:3px; padding-left: 0px">
                {% else %}
                <div class="col-md-{{col}}" id="graph-{{i}}" style="padding:3px;">
                {% endif %}
                        <div class="panel panel-default chart-container" data-u="{{graph.src}}">
                                <div class="panel-heading" style="padding: 15px 20px; background: 0%">
                                    
                                    
                                    <div class="pull-right" style="display: inline-block">
                                        <div class="pull-left" style="display: inline-block; margin-left: 7px;"><a href="javascript:void(0);" class="btn btn-link btn-xs" onclick="return fn_toogle_legend_flot(this, '{{i}}');"> <img src="/static/img/graph_legend.svg"> </a></div>
                                        <div class="pull-left" style="display: inline-block; margin-left: 7px;"><a href="javascript:void(0);" class="btn btn-link btn-xs" onclick="return fn_toogle_sum_flot(this, '{{i}}');"> <img src="/static/img/graph_sum.svg"> </a></div>
                                        <div class="pull-left" style="display: inline-block; margin-left: 7px;">
                                            {%set big_graph = graph.src.replace("graph_type=h", "").replace("graph_type=k", "").replace("graph_type=a", "")%}
                                            {%if graph.src.find("/chart/h") >=0 %}
                                                {%set big_graph = graph.src.replace("/chart/h", "/chart/big")%}
                                                <a href="{{big_graph|safe}}&start=-86400&graph_type=h" target="__blank" class="btn btn-link btn-xs"><img src="/static/img/graph_large.svg"> </a>
                                            {%elif graph.src.find("/chart/k") >=0%}
                                                {%set big_graph = graph.src.replace("/chart/k", "/chart/big")%}
                                                <a href="{{big_graph|safe}}&start=-86400&graph_type=k" target="__blank" class="btn btn-link btn-xs"><img src="/static/img/graph_large.svg"> </a>
                                            {%else%}
                                                {%set big_graph = graph.src.replace("/chart/a", "/chart/big")%}
                                                <a href="{{big_graph|safe}}&start=-86400&graph_type=a" target="__blank" class="btn btn-link btn-xs"><img src="/static/img/graph_large.svg"> </a>
                                            {%endif%}
                                        </div>
                                        {%if g.user.is_root() or g.user.is_admin()%}
                                        <div class="pull-left" style="display: inline-block; margin-left: 7px;"><a href="/graph/{{graph.id}}/edit" target="__blank" class="btn btn-link btn-xs" style="border: none"> <img src="/static/img/graph_edit.svg"> </a></div>
                                        {%endif%}
                                        <div class="pull-left" style="display: inline-block; margin-left: 7px;"><a class="btn btn-link btn-xs reset-zoom" style="border: none" data-index="{{i}}"> <img src="/static/img/graph_rescale.svg"> </a></div>
                                    </div>

                                    <span class="panel-title g-title">{{graph.title}}</span>
                                </div>

                                <div class="panel-body text-center" style="margin:5px;padding:0px;">
                                    <span class="chart-title"></span>
                                </div>

                                <div class="chart-{{i}} chart-area panel-body" style="margin:20px;padding:10px; margin-top: 12px;"></div>
                                <div class="legend panel-body graph-legend"></div>
                        </div>
                    {%set i=i+1%}
                </div>
           {% if (i % layout == 0 or loop.last) %}
             </div>
           {% endif %}
        {%endfor%}
    </div>

{%- endmacro %}


{% macro screen_main_menu(current_top_screen, top_screens) -%}
    <div class="btn-group " >
      <button class="btn btn-default btn-xs dropdown-toggle screen-select" data-toggle="dropdown">
        {%if current_top_screen%}
            {{current_top_screen.name}}
        {%else%}
            <span  style="padding:10px 80px; ">图表</span> 
        {%endif%}
        <span class="caret"></span>
      </button>

      <ul class="dropdown-menu" role="menu"  style="width: 100%">
            {%if g.user.is_root() or g.user.is_admin()%}
            <li><a href="/screen/add" style="font-size:20px;
                font-family:PingFangSC-Regular;
                font-weight:600;
                color:rgba(80,80,80,1);
                line-height:20px; padding: 5px 46%;"> + </a></li>
            {%endif%}
        <li>
            <div class="form-group search-area">
                <input  style="border: none;" class="form-control" id="searchinput" type="search" placeholder="搜索..">
                <hr style="margin: 0px;">
            </div>
        </li>
        {%for c in top_screens%}
        <li class="screen" role="presentation">
            <span role="menuitem" style="margin-left:15px;line-height:25px;"> 
            <a href="/screen/{{c.id}}" ><small class=" screen-select-word">{{c.name}}</small></a>
            {%if g.user.is_root() or g.user.is_admin()%}
            <a href='/screen/{{c.id}}/delete' class="glyphicon glyphicon-remove pull-right" style="margin-right:10px; color: grey;" onclick="return confirm('确定要删除这个screen?');"></a>
            {%endif%}
            </span>
            <hr style="margin:5px;"/>
        </li>
        {%endfor%}
      </ul>

    </div>
{%- endmacro %}

{% macro screen_sub_menu(current_top_screen, current_sub_screen, sub_screens) -%}
    <div class="btn-group" style="margin-left: 0px;">
      <button class="btn btn-default btn-xs dropdown-toggle screen-select" data-toggle="dropdown">
        {%if current_sub_screen %}
            {{current_sub_screen.name}}
        {%else%}
        <span  style="padding:10px 80px; ">选择</span> 
        {%endif%}
        <span class="caret"></span>
      </button>

      <ul class="dropdown-menu" role="menu" style="width: 100%;">
        {%if current_top_screen %}
            {% if g.user.is_root() or g.user.is_admin()%}
            <li><a href="/screen/add?pid={{current_top_screen.id}}" style="font-size:20px;
                font-family:PingFangSC-Regular;
                font-weight:600;
                color:rgba(80,80,80,1);
                line-height:20px; padding: 5px 46%;"> +</a></li>
                <hr style="margin: 0px;">
            {%endif%}
        {%endif%}

        {%for c in sub_screens%}
        <li class="screen" role="presentation">
            <a role="menuitem" href="/screen/{{c.id}}"><small  class=" screen-select-word">{{c.name}}</small></a>
            <hr style="margin:2px;"/>
        </li>
        </li>
        {%endfor%}
      </ul>

    </div>
{%- endmacro %}


{% macro screen_home_menu(current_top_screen, current_sub_screen, sub_screens) -%}
    <div class="btn-group">
      <button class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown">
        {%if current_sub_screen %}
            {{current_sub_screen.name}}
        {%else%}
            选择
        {%endif%}
        <span class="caret"></span>
      </button>

      <ul class="dropdown-menu" role="menu">

        {%for c in sub_screens%}
        <li class="screen" role="presentation">
            <a role="menuitem" href="/screen/home/{{c.id}}"><small>{{c.name}}</small></a>
            <hr style="margin:2px;"/>
        </li>
        </li>
        {%endfor%}
      </ul>

    </div>
{%- endmacro %}